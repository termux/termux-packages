#!@TERMUX_PREFIX@/bin/bash

set -e

sws=()
export _PS_RUN_IN_ALPM_HOOKS=true

while read -r i; do
	sw="$(basename "${i//.sw/}")"
	if [[ -n "${sw}" && "${sw}" != "*" ]]; then
		sws+=("${sw}")
	fi
done

if [[ -n "${sws}" && ("${1}" = "update" || "${1}" = "disable") ]]; then
	sws=($(pacman-switch -Qs ${sws[@]}))
fi

if [ -z "${sws}" ]; then
	exit 0
fi

case "${1}" in
	"enable") pacman-switch -Ea ${sws[@]};;
	"update") pacman-switch -Su ${sws[@]};;
	"disable") pacman-switch -Da ${sws[@]};;
esac
