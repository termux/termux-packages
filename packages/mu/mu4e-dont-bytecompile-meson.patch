# Patch meson to copy mu4e source files even if emacs was not found.
# Also disable dbus since we are not building emacs with dbus support

diff --git a/meson.build b/meson.build
index c64f23e9..bad6e202 100644
--- a/meson.build
+++ b/meson.build
@@ -365,9 +365,7 @@ subdir('mu')
 emacs_name=get_option('emacs')
 emacs_min_version='26.3'
 emacs=find_program([emacs_name], version: '>=' + emacs_min_version, required:false)
-if emacs.found()
-  emacs28 = find_program([emacs_name], version: '>=28', required:false)
-  subdir('man')
+if true
   subdir('mu4e')
 else
   message('emacs not found; not pre-compiling mu4e / generating man-pages')
diff --git a/mu4e/meson.build b/mu4e/meson.build
index 5f0da4d3..9cea3b29 100644
--- a/mu4e/meson.build
+++ b/mu4e/meson.build
@@ -76,13 +76,12 @@ mu4e_srcs=[
 # emacs 28 is guaranteed to have transient
 # not very elegant, but
 # https://stackoverflow.com/questions/49221792/byte-compile-file-only-when-library-is-found
-if emacs28.found()
+if true
   mu4e_srcs += 'mu4e-transient.el'
 endif
 
 # do have we have dbus support?
-emacs_dbus = run_command(emacs, '--batch', '--eval', '(kill-emacs (if (featurep \'dbusbind) 0 1))',
-                         check: false)
+emacs_dbus = run_command('false')
 if emacs_dbus.returncode() == 0
   mu4e_srcs += 'mu4e-dbus.el'
 endif
@@ -94,6 +93,7 @@ endif
 #
 #... so let's not do that!
 
+if false
 foreach src : mu4e_srcs
   target_name= '@BASENAME@.elc'
   target_path = join_paths(meson.current_build_dir(), target_name)
@@ -136,6 +136,7 @@ mu4e_autoloads = configure_file(
             '--load', 'package',
             '--eval', '(package-generate-autoloads "mu4e" "' +
                       meson.current_build_dir() + '" )'])
+endif
 
 # also install the sources and the config
 install_data(mu4e_srcs, install_dir: mu4e_lispdir)
