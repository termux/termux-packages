#!/data/data/com.termux/files/usr/bin/bash

# AETHER-SYNC v7.4.1 - INTERNAL BUILD
SHADOW="/data/data/com.termux/files/usr/share/aether-sync/shadow"

YELLOW="\033[1;33m"
BLUE="\033[1;34m"
GREEN="\033[1;32m"
RESET="\033[0m"

case "$1" in
    "--morph")
        echo -e "${GREEN}[AETHER]${RESET} Engaging Stealth Isolation..."
        
        export HOME="/root"
        export USER="root"
        export PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/system/bin:/system/xbin"
        export HISTFILE=/dev/null

        INIT_CMD=$(mktemp)
        cat <<P-EOF > "$INIT_CMD"
shopt -s expand_aliases

# Environment Identity
alias whoami='echo "root"'
alias id='echo "uid=0(root) gid=0(root) groups=0(root)"'

# Prompt Masking
export PS1='\[\033[1;35m\]~#aether\[\033[0m\]\[\033[1;33m\]\${PWD#$SHADOW}\[\033[0m\]$: '
[[ "\$PS1" == *"$: "* ]] && export PS1="\${PS1//\$: / /}: "

# Absolute Path Isolation
alias ls='l_s(){ if [[ "\$PWD" == "$SHADOW" && "\$*" == *".."* ]]; then echo "ls: cannot access '\''..'\'': Permission denied"; else command ls --color=auto "\$@"; fi; }; l_s'
alias cd='c_d(){ if [[ "\$PWD" == "$SHADOW" && ("\$1" == ".." || "\$1" == "/" || "\$1" == "../..") ]]; then builtin cd "$SHADOW"; else builtin cd "\$1" 2>/dev/null || builtin cd "$SHADOW/\$1"; fi; }; c_d'

# Operational Warning
echo -e "${YELLOW}Warning: Please do not delete the cache and data using aether --kill, as we are in the emulation process.${RESET}"

builtin cd "$SHADOW"
P-EOF
        exec /data/data/com.termux/files/usr/bin/bash --rcfile "$INIT_CMD"
    ;;

    *)
        echo "Aether-Sync v7.4.1"
        echo "Usage: aether --morph"
    ;;
esac
